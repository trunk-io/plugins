version: 0.1
lint:
  downloads:
    - name: terrascan
      version: 1.18.1
      downloads:
        - os:
            linux: Linux
            macos: Darwin
            windows: Windows
          cpu:
            x86_64: x86_64
            arm_64: arm64
          url: https://github.com/tenable/terrascan/releases/download/v${version}/terrascan_${version}_${os}_${cpu}.tar.gz
  definitions:
    - name: terrascan
      download: terrascan
      known_good_version: 1.18.1
      files: [terraform]
      suggest_if: config_present
      commands:
        - name: lint
          output: sarif
          is_security: true
          run: terrascan scan --iac-file ${target} --output sarif
          success_codes: [0, 3, 4, 5]
          read_output_from: stdout
          parser:
            runtime: python
            run: ${plugin}/linters/terrascan/sarif_to_sarif.py
      version_command:
        parse_regex: "version: v${semver}"
        run: terrascan version
      environment:
        - name: PATH
          list: ["${linter}"]
      direct_configs: [terrascan_config.toml]
