version: 0.1
lint:
  downloads:
    - name: pmd
      downloads:
        # Cross-platform download
        - url: https://github.com/pmd/pmd/releases/download/pmd_releases%2F${semver}/pmd-dist-${semver}-bin.zip
          strip_components: 1
          version: 7.0.0-rc3
        - url: https://github.com/pmd/pmd/releases/download/pmd_releases%2F${semver}/pmd-bin-${semver}.zip
          strip_components: 1
          version: <7.0.0
      args:
        semver: ${version}=>(pmd_releases\/)*(?P<semver>.*)
  definitions:
    - name: pmd
      download: pmd
      commands:
        - name: lint-apex
          output: sarif
          # Override this in your repo if you have a custom rulesets
          run:
            pmd check -R rulesets/apex/quickstart.xml -d ${target} -f sarif --no-progress
            --report-file=${tmpfile}
          success_codes: [0, 4]
          read_output_from: tmp_file
          batch: true
          cache_results: true
          version: ">6.55.0"
          files:
            - apex
        - name: lint-java
          output: sarif
          # Override this in your repo if you have a custom rulesets
          run:
            pmd check -R rulesets/java/quickstart.xml -d ${target} -f sarif --no-progress
            --report-file=${tmpfile}
          success_codes: [0, 4]
          read_output_from: tmp_file
          batch: true
          cache_results: true
          version: ">6.55.0"
          files:
            - java
      runtime: java
      suggest_if: never
      known_good_version: 6.55.0
      environment:
        - name: PATH
          list: ["${env.PATH}"]
