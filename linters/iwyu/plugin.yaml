version: 0.1
downloads:
  - name: include-what-you-use
    version: 0.20
    downloads:
      - os:
          linux: linux
        cpu:
          arm_64: aarch64
          x86_64: x86_64
        url: https://trunk.io/releases/include-what-you-use-${version}-${os}-${cpu}.tar.gz
      - os:
          macos: macos
        cpu:
          x86_64: x86_64
          arm_64: arm64
        url: https://trunk.io/releases/include-what-you-use-${version}-${os}-${cpu}.tar.gz
      # TODO(chris): Windows download
tools:
  definitions:
    - name: include-what-you-use
      download: include-what-you-use
      shims: [include-what-you-use]
      known_good_version: 0.20
      environment:
        - name: PATH
          list: ["${tool}/bin"]
lint:
  definitions:
    - name: include-what-you-use
      files: [c/c++-source]
      tools: [include-what-you-use]
      commands:
        - name: lint
          run_from: ${compile_command}
          run: include-what-you-use -Xiwyu --no_fwd_decls "${compile_command}"
          # Custom parser type defined in the trunk cli to handle iwyu's output.
          output: iwyu
          cache_results: true
          success_codes: [0]
          disable_upstream: true
          read_output_from: stderr
      hold_the_line: false
      include_scanner_type: compile_command
      query_compile_commands: true
      suggest_if: never
      known_good_version: 0.20
      version_command:
        parse_regex: include-what-you-use ([^ ]+).*
        run: include-what-you-use --version
